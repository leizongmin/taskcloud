<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Editor</title>
<style type="text/css" media="screen">
#editor {
	margin: 8px;
	left: 0px;
	right: 0px;
	top: 30px;
	bottom: 0px;
}
</style>
</head>
<body>

<button onclick="saveCode();">保存</button>
<pre id="editor"></pre>

<script src="http://lib.sinaapp.com/js/jquery/1.6.2/jquery.min.js"></script>
<script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="ace/theme-textmate.js" type="text/javascript" charset="utf-8"></script>
<script src="ace/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
<script>
/* 创建编辑器 */
window.onload = function() {
	window.editor = ace.edit("editor");
	editor.setTheme("ace/theme/textmate");
	var JavaScriptMode = require("ace/mode/javascript").Mode;
	editor.getSession().setMode(new JavaScriptMode());
	editor.setFontSize('14px');
		
	/* 自动打开文件 */
	var filename = window.location.hash.substr(1);
	$.getJSON('/template/' + filename, function (d) {
		if (d.status < 1)
			alert('无法打开模板"' + filename + '"');
		else {
			editor.getSession().setValue(d.data);
			window.template_file = filename;
		}
	});
};

/* 保存代码 */
var saveCode = function () {
	var filename = window.template_file;
	var code = editor.getSession().getValue();
	$.post('/template/' + filename, {code: code}, function (d) {
		if (d.status < 1)
			alert('保存失败！');
		else
			alert('保存成功！');
	}, 'json');
}
</script>

</body>
</html>
